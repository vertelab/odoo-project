<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="project_timeline.view_task_form2" model="ir.ui.view">
        <field name="name">project.task.form</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='user_ids']" position="after">
                <field name="date_start" />
                <field name="date_end" />
                <field name="color" widget="color_picker"/>
            </xpath>
             <field name="child_ids" position="attributes">
                    <!-- Extend the context attribute -->
                    <attribute name="context">{'search_view_ref': 'project.view_task_search_form_extended',
                         'default_project_id': project_id if not parent_id or not display_project_id else display_project_id,
                         'default_user_ids': user_ids,
                         'default_parent_id': id,
                         'default_partner_id': partner_id,
                         'default_milestone_id': allow_milestones and milestone_id,
                         'search_default_display_project_id': project_id,
                         'default_date_start': date_start,
                         'default_date_end': date_end,
                         'default_color': color,
                        }</attribute>

                </field>
        </field>
    </record>
    
    
    <record id="project_timeline.project_task_timeline" model="ir.ui.view">
        <field name="model">project.task</field>
        <field name="type">timeline</field>
        <field name="arch" type="xml">
            <timeline
                date_start="date_start"
                date_stop="date_end"
                default_group_by="project_id"
                event_open_popup="true"
                colors="white: color == 0; #f06050: color == '1'; #f4a460: color == '2'; #f7cd1f: color == '3'; #6cc1ed: color == '4'; #814968: color == '5'; #eb7e7f: color == '6' 
                ; #2c8397: color == '7'; #475577: color == '8'; #d6145f: color == '9'; #30c381: color == '10'; #9365b8: color == '11'"
                dependency_arrow="child_ids"
            >
                <field name="user_ids" />
                <field name="planned_hours" />
                <templates>
                    <t t-name="timeline-item">
                        <div class="o_project_timeline_item">
                            <t t-foreach="record.user_ids" t-as="user">
                                <img
                                    t-if="record.user_ids"
                                    t-attf-src="/web/image/res.users/#{user}/image_128/16x16"
                                    t-att-title="record.user"
                                    width="16"
                                    height="16"
                                    class="mr8"
                                    alt="User"
                                />
                            </t>
                            <span name="display_name">
                                <t t-esc="record.display_name" />
                            </span>
                            <small
                                name="planned_hours"
                                class="text-info ml4"
                                t-if="record.planned_hours"
                            >
                                <t
                                    t-esc="field_utils.format.float_time(record.planned_hours)"
                                />
                            </small>
                        </div>
                    </t>
                </templates>
            </timeline>
        </field>
    </record>

</odoo>
